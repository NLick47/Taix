<ResourceDictionary xmlns="https://github.com/avaloniaui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:button="using:UI.Controls.Button"
                    xmlns:base="using:UI.Controls.Base"
                    xmlns:converter="using:UI.Controls.Converters"
                    xmlns:controls="using:UI.Controls.Select"
                    xmlns:select="clr-namespace:UI.Themes.Select">
    <SolidColorBrush x:Key="ThemeLightBrush" Color="{DynamicResource ThemeColor}" Opacity=".1" />
    <select:DateFormatConverter x:Key="DateFormatConverter" />
    <converter:MultiValueToBoolConverter x:Key="MultiValueToBoolConverter" />
    <DataTemplate x:Key="DayViewTemplate" x:DataType="controls:DayModel">
       <Border>
           <Border.IsEnabled>
               <MultiBinding
                   Converter="{StaticResource MultiValueToBoolConverter}">
                   <Binding Path="IsOut" />
                   <Binding Path="IsDisabled" />
               </MultiBinding>
           </Border.IsEnabled>
          
           
           <Border 
               Margin="0,0,0,0"
               Width="35"
               Height="35"
               CornerRadius="5">
              
               <Border.Styles>
                   <Style Selector="Border">
                       <Setter Property="Background" Value="Transparent"/>
                   </Style>
                
                   <Style Selector="Border:pointerover">
                       <Setter Property="Background" Value="{DynamicResource ThemeColor}"/>
                   </Style>
                   
                   <Style Selector="Border:disabled TextBlock">
                       <Setter Property="Foreground"
                               Value="{DynamicResource DisabledTextBrush}" />
                   </Style>
               </Border.Styles>
            
          

               <TextBlock x:DataType="controls:DayModel"
                          VerticalAlignment="Center"
                          HorizontalAlignment="Center"
                          Text="{Binding Day,
                       Converter={StaticResource DateFormatConverter},
                       ConverterParameter={x:Static controls:DateSelectType.Date}}" />

               <Interaction.Behaviors>
                   <EventTriggerBehavior EventName="PointerReleased">
                       <InvokeCommandAction Command="{Binding $parent[controls:DateSelect].SelectDayCommand}" 
                                            CommandParameter="{Binding }" />
                   </EventTriggerBehavior>
               </Interaction.Behaviors>
           </Border>
       </Border>
    </DataTemplate>

    <!-- 月视图模板 -->
    <DataTemplate x:Key="MonthViewTemplate" x:DataType="controls:DayModel">
        <Border     
            IsEnabled="{Binding !IsDisabled}"
            Margin="0,0,0,0"
            Padding="0"
            Width="55"
            Height="55">
            
          <Border Width="45"
                  CornerRadius="8"
                  Height="45">
              <Border.Styles>
                  <Style Selector="Border">
                      <Setter Property="Background" Value="Transparent"/>
                  </Style>
                
                  <Style Selector="Border:pointerover">
                      <Setter Property="Background" Value="{DynamicResource ThemeColor}"/>
                  </Style>
                  
                  <Style Selector="Border:disabled TextBlock">
                      <Setter Property="Foreground"
                              Value="{DynamicResource DisabledTextBrush}" />
                  </Style>
              </Border.Styles>
              
              
              
              <Border.IsEnabled>
                  <MultiBinding
                      Converter="{StaticResource MultiValueToBoolConverter}">
                      <Binding Path="IsOut" />
                      <Binding Path="IsDisabled" />
                  </MultiBinding>
              </Border.IsEnabled>
            
              <TextBlock x:DataType="controls:DayModel"
                         VerticalAlignment="Center"
                         HorizontalAlignment="Center"
                         Text="{Binding Day,
                       Converter={StaticResource DateFormatConverter},
                       ConverterParameter={x:Static controls:DateSelectType.Month}}" />

              <Interaction.Behaviors>
                  <EventTriggerBehavior EventName="PointerReleased">
                      <InvokeCommandAction Command="{Binding $parent[controls:DateSelect].SelectDayCommand}" 
                                           CommandParameter="{Binding }"/>
                  </EventTriggerBehavior>
              </Interaction.Behaviors>
          </Border>
            
           
        </Border>
    </DataTemplate>

    <!-- 年视图模板 -->
    <DataTemplate x:Key="YearViewTemplate" x:DataType="controls:DayModel">
        <Border     
            IsEnabled="{Binding !IsDisabled}"
            Margin="0,0,0,0"
            Padding="0"
            Width="55"
            Height="55">
            <Border Width="45"
                    CornerRadius="8"
                    Height="45">
                <Border.Styles>
                    <Style Selector="Border">
                        <Setter Property="Background" Value="Transparent"/>
                    </Style>
                    
                    <Style Selector="Border:pointerover">
                        <Setter Property="Background" Value="{DynamicResource ThemeColor}"/>
                    </Style>
                    
                    <Style Selector="Border:disabled TextBlock">
                        <Setter Property="Foreground"
                                Value="{DynamicResource DisabledTextBrush}" />
                    </Style>
                </Border.Styles>
                
                <Border.IsEnabled>
                    <MultiBinding
                        Converter="{StaticResource MultiValueToBoolConverter}">
                        <Binding Path="IsOut" />
                        <Binding Path="IsDisabled" />
                    </MultiBinding>
                </Border.IsEnabled>
            
              
                <TextBlock x:DataType="controls:DayModel"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center"
                           Text="{Binding Day,
                       Converter={StaticResource DateFormatConverter},
                       ConverterParameter={x:Static controls:DateSelectType.Year}}" />

                <Interaction.Behaviors>
                    <EventTriggerBehavior EventName="PointerReleased">
                        <InvokeCommandAction Command="{Binding $parent[controls:DateSelect].SelectDayCommand}" 
                                             CommandParameter="{Binding }"/>
                    </EventTriggerBehavior>
                </Interaction.Behaviors>
            </Border>
        </Border>
    </DataTemplate>


    <converter:ToStringConverter x:Key="ToStringConverter" />
    
    <ControlTheme x:Key="{x:Type controls:DateSelect}" TargetType="controls:DateSelect">
        <Setter Property="Background" Value="Transparent" />
        
        <Styles>
            <Style Selector="controls|DateSelect[SelectType=Date]">
                <Style Selector="^ /template/ Border#DaySelect">
                    <Setter Property="IsVisible" Value="True" />
                </Style>
                
                <Style Selector="^ /template/ ItemsControl#ItemsControl">
                    <Setter Property="ItemTemplate">
                        <StaticResource ResourceKey="DayViewTemplate"/>
                    </Setter>
                </Style>

                <Style Selector="^ /template/ StackPanel#MonthSelect">
                    <Setter Property="IsVisible" Value="True" />
                </Style>

                <Style Selector="^ /template/ Border#DayHeader">
                    <Setter Property="IsVisible" Value="True" />
                </Style>
            </Style>


            <Style Selector="controls|DateSelect[SelectType=Month]">
                <Style Selector="^ /template/ Border#DaySelect">
                    <Setter Property="IsVisible" Value="True" />
                </Style>
                
                <Style Selector="^ /template/ ItemsControl#ItemsControl">
                    <Setter Property="ItemTemplate">
                        <StaticResource ResourceKey="MonthViewTemplate"/>
                    </Setter>
                </Style>

                <Style Selector="^ /template/ StackPanel#MonthSelect">
                    <Setter Property="IsVisible" Value="False" />
                </Style>

                <Style Selector="^ /template/ Border#DayHeader">
                    <Setter Property="IsVisible" Value="False" />
                </Style>
            </Style>


            <Style Selector="controls|DateSelect[SelectType=Year]">
                <Style Selector="^ /template/ Border#DaySelect">
                    <Setter Property="IsVisible" Value="True" />
                </Style>

                <Style Selector="^ /template/ Border#YearMonthSelection">
                    <Setter Property="IsVisible" Value="False" />
                </Style>
                
                <Style Selector="^ /template/ ItemsControl#ItemsControl">
                    <Setter Property="ItemTemplate">
                        <StaticResource ResourceKey="YearViewTemplate"/>
                    </Setter>
                </Style>
            </Style>

            <Style Selector="controls|DateSelect:pointerover">
                <Style Selector="^ /template/ Border#Main">
                    <Setter Property="Background" Value="{DynamicResource HoverBackgroundBrush}" />
                </Style>

                <Style Selector="^ /template/ base|Icon#Icon">
                    <Setter Property="Foreground" Value="{DynamicResource ThemeBrush}" />
                </Style>
            </Style>
        </Styles>
        <Setter Property="Template">
            <ControlTemplate>
                <Border Background="{TemplateBinding Background}"
                        HorizontalAlignment="Left">
                    <Grid>
                        <Border Background="{Binding ElementName=Main,Path=Background}" ZIndex="-1"
                                Width="{Binding ElementName=Main,Path=Bounds.Width}"
                                Height="{Binding ElementName=Main,Path=Bounds.Height}"
                                CornerRadius="{Binding ElementName=Main,Path=CornerRadius}">
                            <Border.Effect>
                                <DropShadowEffect Color="#d8d2d2" BlurRadius="1"
                                                  OffsetX="-3.46"
                                                  OffsetY="2" Opacity="0.1" />
                            </Border.Effect>
                        </Border>

                        <Border x:Name="Main" Margin="0,0,0,0"
                                Background="{DynamicResource StandardBackgroundBrush}"
                                HorizontalAlignment="Left" Padding="18,10"
                                CornerRadius="5">
                            <Interaction.Behaviors>
                                <EventTriggerBehavior EventName="PointerPressed">
                                    <InvokeCommandAction
                                        Command="{Binding RelativeSource={RelativeSource AncestorType={x:Type controls:DateSelect}}, 
									Path=ShowSelectCommand}" />

                                </EventTriggerBehavior>

                            </Interaction.Behaviors>
                            <StackPanel Orientation="Horizontal">
                                <base:Icon x:Name="Icon" IconType="Calendar"
                                           Foreground="{DynamicResource StandardTextBrush}" />
                                <TextBlock Foreground="{DynamicResource StandardTextBrush}"
                                           Text="{TemplateBinding DateStr}" VerticalAlignment="Center" Margin="5,0,0,0" />
                            </StackPanel>
                        </Border>

                        <!--选择-->
                        <Popup 
                               x:Name="Popup"
                               Placement="Bottom"
                               PlacementTarget="{Binding ElementName=Main}"
                               IsOpen="{Binding RelativeSource={RelativeSource AncestorType={x:Type controls:DateSelect}}, 
							Path=IsOpen,Mode=TwoWay}">
                            <Border
                                x:Name="SelectContainer"
                                CornerRadius="10"
                                BorderBrush="{DynamicResource PopupBorderBrush}"
                                BorderThickness="1"
                                Background="{DynamicResource PopupBackgroundBrush}"
                                Padding="10"
                                Margin="10">
                                <Border.Effect>
                                    <DropShadowDirectionEffect
                                        BlurRadius="10" ShadowDepth="2"
                                        Direction="315" Color="Gray"
                                        Opacity=".1" />
                                </Border.Effect>

                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <!--年份月份选择-->
                                    <Border Height="40" x:Name="YearMonthSelection">
                                        <Grid HorizontalAlignment="Center">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>

                                            <!--年份选择-->
                                            <StackPanel Orientation="Horizontal">
                                                <button:IconButton Icon="ChevronLeft"
                                                                   FontSize="12"
                                                                   VerticalAlignment="Center"
                                                                   Command="{Binding SetYearCommand, RelativeSource={RelativeSource TemplatedParent}}"
                                                                   CommandParameter="-1" />
                                                <TextBlock
                                                    Foreground="{DynamicResource StandardTextBrush}"
                                                    TextAlignment="Center" Margin="5,0"
                                                    VerticalAlignment="Center">
                                                    <Run
                                                        Text="{TemplateBinding Year ,Converter={StaticResource ToStringConverter}}" />
                                                    <Run Text="{DynamicResource Year}" />
                                                </TextBlock>
                                                <button:IconButton Icon="ChevronRight" FontSize="12"
                                                                   VerticalAlignment="Center"
                                                                   Command="{Binding SetYearCommand, RelativeSource={RelativeSource TemplatedParent}}"
                                                                   CommandParameter="1" />

                                            </StackPanel>
                                            <StackPanel Grid.Column="1"
                                                        Orientation="Horizontal" x:Name="MonthSelect"
                                                        IsVisible="False">
                                                <button:IconButton Icon="ChevronLeft"
                                                                   FontSize="12"
                                                                   VerticalAlignment="Center"
                                                                   Command="{Binding SetMonthCommand, RelativeSource={RelativeSource TemplatedParent}}"
                                                                   CommandParameter="-1" />
                                                <TextBlock
                                                    Foreground="{DynamicResource StandardTextBrush}"
                                                    TextAlignment="Center" Margin="5,0"
                                                    VerticalAlignment="Center">
                                                    <Run
                                                        Text="{TemplateBinding Month ,Converter= {StaticResource ToStringConverter}}" />
                                                    <Run Text="{DynamicResource Month}" />
                                                </TextBlock>

                                                <button:IconButton Icon="ChevronRight"
                                                                   FontSize="12"
                                                                   VerticalAlignment="Center"
                                                                   Command="{Binding SetMonthCommand, RelativeSource={RelativeSource TemplatedParent}}"
                                                                   CommandParameter="1" />

                                            </StackPanel>
                                        </Grid>
                                    </Border>

                                    <!--日选择-->
                                    <Border Grid.Row="1" Width="250" x:Name="DaySelect" IsVisible="False">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="auto" />
                                                <RowDefinition Height="auto" />
                                            </Grid.RowDefinitions>

                                            <Border Grid.Row="0" Margin="0,15,0,0"
                                                    IsVisible="False"
                                                    x:Name="DayHeader"
                                                    BorderBrush="{DynamicResource SettingPanelSpliteLineBrush}"
                                                    BorderThickness="0,0,0,.5" Padding="0,0,0,10">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="35" />
                                                        <ColumnDefinition Width="35" />
                                                        <ColumnDefinition Width="35" />
                                                        <ColumnDefinition Width="35" />
                                                        <ColumnDefinition Width="35" />
                                                        <ColumnDefinition Width="35" />
                                                        <ColumnDefinition Width="35" />
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Grid.Column="0" Text="{DynamicResource Mon}"
                                                               HorizontalAlignment="Center"
                                                               Foreground="{DynamicResource SubTextBrush}" />
                                                    <TextBlock Grid.Column="1" Text="{DynamicResource Tue}"
                                                               HorizontalAlignment="Center"
                                                               Foreground="{DynamicResource SubTextBrush}" />
                                                    <TextBlock Grid.Column="2" Text="{DynamicResource Wed}"
                                                               HorizontalAlignment="Center"
                                                               Foreground="{DynamicResource SubTextBrush}" />
                                                    <TextBlock Grid.Column="3" Text="{DynamicResource Thu}"
                                                               HorizontalAlignment="Center"
                                                               Foreground="{DynamicResource SubTextBrush}" />
                                                    <TextBlock Grid.Column="4" Text="{DynamicResource Fri}"
                                                               HorizontalAlignment="Center"
                                                               Foreground="{DynamicResource SubTextBrush}" />
                                                    <TextBlock Grid.Column="5" Text="{DynamicResource Sat}"
                                                               HorizontalAlignment="Center"
                                                               Foreground="{DynamicResource SubTextBrush}" />
                                                    <TextBlock Grid.Column="6" Text="{DynamicResource Sun}"
                                                               HorizontalAlignment="Center"
                                                               Foreground="{DynamicResource SubTextBrush}" />

                                                </Grid>
                                            </Border>

                                            <ItemsControl Grid.Row="1"
                                                          x:Name="ItemsControl"
                                                          ItemsSource="{TemplateBinding Days}"
                                                          Margin="0,10,0,0"
                                                          ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                                                <ItemsControl.Styles>
                                                    <Style Selector="ItemsControl">
                                                        <Setter Property="Template">
                                                            <ControlTemplate>
                                                                <Border>
                                                                    <ItemsPresenter
                                                                        ItemsPanel="{TemplateBinding ItemsPanel}" />
                                                                </Border>
                                                            </ControlTemplate>
                                                        </Setter>
                                                    </Style>

                                                    <Style Selector="ContentPresenter">
                                                        <Setter Property="Foreground"
                                                                Value="{DynamicResource StandardTextBrush}" />
                                                        <Setter Property="HorizontalAlignment" Value="Center" />
                                                        <Setter Property="VerticalAlignment" Value="Center" />
                                                    </Style>
                                                    
                                                    
                                                </ItemsControl.Styles>

                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <WrapPanel HorizontalAlignment="Center"/>
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                
                                            </ItemsControl>
                                            
                                           
                                        </Grid>
                                    </Border>
                                </Grid>
                            </Border>
                        </Popup>
                    </Grid>
                </Border>
            </ControlTemplate>
        </Setter>
    </ControlTheme>
</ResourceDictionary>